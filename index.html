<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Contador regresivo — Próxima quincena</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#6ee7b7;--muted:#94a3b8}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial;background:linear-gradient(180deg,#071029 0%, #071b2a 100%);color:#e6eef6;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px;overflow:hidden}
    .card{background:rgba(255,255,255,0.03);padding:28px;border-radius:14px;box-shadow:0 6px 30px rgba(2,6,23,0.6);max-width:640px;width:100%;text-align:center;position:relative;z-index:1}
    h1{margin:0 0 8px;font-size:20px}
    p.lead{margin:0 0 20px;color:var(--muted)}
    .countdown{display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
    .unit{background:rgba(255,255,255,0.03);min-width:110px;padding:18px;border-radius:10px}
    .value{font-size:32px;font-weight:700;color:var(--accent);line-height:1}
    .label{font-size:12px;color:var(--muted);margin-top:6px}
    .meta{margin-top:18px;color:var(--muted);font-size:14px}
    .controls{display:flex;gap:8px;justify-content:center;margin-top:18px}
    button{background:transparent;border:1px solid rgba(255,255,255,0.06);color:inherit;padding:8px 12px;border-radius:8px;cursor:pointer}
    input[type=date]{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:8px;color:inherit}
    footer{margin-top:18px;font-size:12px;color:var(--muted)}
    .mensaje-pago{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);background:#00ffcc;color:#000;padding:30px 50px;font-size:28px;font-weight:900;border-radius:20px;box-shadow:0 0 40px rgba(0,255,204,0.8);z-index:1000;transition:transform 0.3s ease;}
    .mensaje-activo{transform:translate(-50%,-50%) scale(1);animation:shake 0.5s ease infinite alternate;}
    @keyframes shake{0%{transform:translate(-50%,-50%) rotate(-3deg);}100%{transform:translate(-50%,-50%) rotate(3deg);}}
    canvas.confetti{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:999;}
  </style>
</head>
<body>
  <canvas class="confetti" id="confetti"></canvas>
  <div class="card">
    <h1>¿Cuánto falta para la próxima quincena?</h1>
    <p class="lead">Este contador asume que las quincenas o pagos son los días <strong>1</strong>, <strong>15</strong>, <strong>16</strong> y <strong>30</strong> de cada mes a las <strong>7:00 p.m.</strong>.</p>

    <div class="countdown" aria-live="polite" id="countdown">
      <div class="unit">
        <div class="value" id="days">--</div>
        <div class="label">Días</div>
      </div>
      <div class="unit">
        <div class="value" id="hours">--</div>
        <div class="label">Horas</div>
      </div>
      <div class="unit">
        <div class="value" id="minutes">--</div>
        <div class="label">Minutos</div>
      </div>
      <div class="unit">
        <div class="value" id="seconds">--</div>
        <div class="label">Segundos</div>
      </div>
    </div>

    <div class="meta" id="meta">Calculando...</div>

    <div class="controls">
      <label for="customStart" style="display:flex;align-items:center;gap:8px">
        <input type="date" id="customStart" title="Fecha para la que quieres calcular la quincena"/>
      </label>
      <button id="apply">Usar fecha seleccionada</button>
      <button id="reset">Volver a hoy</button>
    </div>

    <footer>Si hoy es día de pago el contador mostrará 0 días.</footer>
  </div>

  <div class="mensaje-pago" id="mensajePago"></div>
  <audio id="audioCelebracion" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_4cb0b3c84a.mp3?filename=party-horn-1-185581.mp3"></audio>

  <script>
    function getNextPago(fromDate){
      const year = fromDate.getFullYear();
      const month = fromDate.getMonth();
      const horasPago = 19; // 7:00 p.m.
      const diasPago = [1, 15, 16, 30];
      let posibles = diasPago.map(d => new Date(year, month, d, horasPago, 0, 0, 0)).filter(d => d.getMonth() === month);
      let target = posibles.find(d => d > fromDate);
      if(!target){
        const nextMonth = new Date(year, month + 1, 1);
        const nextYear = nextMonth.getFullYear();
        const nextM = nextMonth.getMonth();
        target = diasPago.map(d => new Date(nextYear, nextM, d, horasPago, 0, 0, 0)).find(d => d.getMonth() === nextM);
      }
      return target;
    }

    function timeDiffParts(target, now){
      let diff = Math.max(0, Math.floor((target - now) / 1000));
      const days = Math.floor(diff / 86400);
      diff -= days * 86400;
      const hours = Math.floor(diff / 3600);
      diff -= hours * 3600;
      const minutes = Math.floor(diff / 60);
      const seconds = diff - minutes * 60;
      return {days, hours, minutes, seconds};
    }

    function updateCountdown(targetDate){
      const now = new Date();
      const parts = timeDiffParts(targetDate, now);
      document.getElementById('days').textContent = parts.days;
      document.getElementById('hours').textContent = String(parts.hours).padStart(2,'0');
      document.getElementById('minutes').textContent = String(parts.minutes).padStart(2,'0');
      document.getElementById('seconds').textContent = String(parts.seconds).padStart(2,'0');

      const meta = document.getElementById('meta');
      const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
      const targetText = targetDate.toLocaleDateString(undefined, options);

      if(parts.days === 0 && parts.hours === 0 && parts.minutes === 0 && parts.seconds === 0){
        meta.textContent = '¡Hoy es día de pago! (' + targetText + ')';
        mostrarMensajePago();
      } else {
        meta.textContent = 'Próximo pago: ' + targetText + '.';
      }
    }

    function mostrarMensajePago(){
      const mensajes = ["¡FOQUIN PAGARON!", "YA CHILLÓ LA RATA"];
      const mensajeAleatorio = mensajes[Math.floor(Math.random() * mensajes.length)];
      const mensajeDiv = document.getElementById('mensajePago');
      mensajeDiv.textContent = mensajeAleatorio;
      mensajeDiv.classList.add('mensaje-activo');
      lanzarConfeti();
      reproducirSonido();
      setTimeout(()=>{
        mensajeDiv.classList.remove('mensaje-activo');
      }, 7000);
    }

    function reproducirSonido(){
      const audio = document.getElementById('audioCelebracion');
      audio.currentTime = 0;
      audio.play().catch(e=>console.log('El sonido no pudo reproducirse automáticamente: ', e));
    }

    function lanzarConfeti(){
      const canvas = document.getElementById('confetti');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      const piezas = Array.from({length:150}, () => ({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height - canvas.height,
        r: Math.random() * 6 + 4,
        d: Math.random() * 0.5 + 0.5,
        color: `hsl(${Math.random()*360},100%,60%)`
      }));

      function dibujar(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        piezas.forEach(p=>{
          ctx.beginPath();
          ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
          ctx.fillStyle=p.color;
          ctx.fill();
        });
      }

      function actualizar(){
        piezas.forEach(p=>{
          p.y += p.d*6;
          if(p.y > canvas.height){p.y = -10; p.x = Math.random()*canvas.width;}
        });
      }

      let duracion = 7000;
      let intervalo = setInterval(()=>{dibujar();actualizar();},16);
      setTimeout(()=>clearInterval(intervalo), duracion);
    }

    let intervalId = null;
    function startCounter(baseDate){
      if(intervalId) clearInterval(intervalId);
      let target = getNextPago(baseDate);

      function tick(){updateCountdown(target);}
      tick();
      intervalId = setInterval(tick, 1000);
    }

    const today = new Date();
    startCounter(today);

    document.getElementById('apply').addEventListener('click', ()=>{
      const input = document.getElementById('customStart').value;
      if(!input){alert('Selecciona primero una fecha (formato: aaaa-mm-dd).');return;}
      const parts = input.split('-');
      const d = new Date(Number(parts[0]), Number(parts[1]) - 1, Number(parts[2]));
      startCounter(d);
    });

    document.getElementById('reset').addEventListener('click', ()=>{
      document.getElementById('customStart').value = '';
      startCounter(new Date());
    });
  </script>
</body>
</html>
